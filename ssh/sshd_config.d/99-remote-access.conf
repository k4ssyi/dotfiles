# Tailscale + SSH リモートアクセス用 sshd 硬化設定
# /etc/ssh/sshd_config.d/ にコピーして使用

# --- 認証設定 ---
# 公開鍵認証のみ許可
AuthenticationMethods publickey
PasswordAuthentication no
KbdInteractiveAuthentication no
PermitEmptyPasswords no
HostbasedAuthentication no

# rootログインを禁止
PermitRootLogin no

# 認証試行回数を制限
MaxAuthTries 3
# ログイン猶予時間（秒）
LoginGraceTime 30

# --- セッション制限 ---
MaxSessions 2

# --- 転送の無効化（不要な攻撃面を削減） ---
X11Forwarding no
AllowTcpForwarding no
AllowAgentForwarding no
PermitTunnel no

# --- 接続維持設定（モバイル回線のタイムアウト防止） ---
ClientAliveInterval 60
ClientAliveCountMax 3

# --- アクセス制御 ---
# インストール時に __CURRENT_USER__ が実行ユーザー名に自動置換される
AllowUsers __CURRENT_USER__
